# Change Log

### 1.1.0rc1 ~ 1.1.0rc13

- 发布稳定预备版
- 导入/导出附带的授权链接、自动触发配置、批处理仅替换具有相同ID的数据
- API调用示例不再提供「扁平」形式传参
- 增加页面级代码编辑器锁
- 增加文件服务功能
- 修复已知问题
- 优化UI展示
- 解决部分浏览器兼容问题

### 1.0.59 ~ 1.0.60

- `DFF.RESP(...)`分拆为2个函数：
    - 返回数据：`DFF.RSEP(data, status_code=None, content_type=None, headers=None, allow_304=False)`
    - 返回文件：`DFF.RESP_FILE(file_path, status_code=None, headers=None, allow_304=False, auto_delete=False, download=True)`
- 其他细节优化

### 1.0.58

- 优化「文件工具」

### 1.0.57

- 导出脚本集功能支持同时导出授权链接、自动触发配置、批处理
- 优化UI展示
- 增加国际化支持
    - 部分内容提供英文版界面
- 增加`reset-admin.py`脚本，用于重置admin用户密码（使用方式：`python reset-admin.py`）
- 添加PIP工具，支持在UI界面安装Python包
- 添加文件工具，支持在UI界面浏览等基本操作
- 添加更多`DFF.*`功能
    - `DFF.RSRC(...)`生成资源目录下文件的绝对路径
    - `DFF.RESP(...)`生成自定义API返回结果
- 导出的函数API支持自定义返回格式/内容（如返回html页面、下载文件等）
- 导出的函数API支持文件上传
- 调整额外安装第三方Python包的存放位置（现在为`{安装目录}/data/resources/extra-python-packages`）

### 1.0.55 ~ 1.0.56

- Worker添加内置库
    - Jinja2==2.11.2
    - Mako==1.1.3

### 1.0.51 ~ 1.0.54

- 减少导入/导出脚本包，脚本库还原点时间线展示数量（最多50）

### 1.0.47 ~ 1.0.50

- 增加MQTT 数据源支持
- 自动部署脚本优化，增加多个选项，详情见[README.md](README.md)
- 修复已知Bug

### 1.0.45 ~ 1.0.46

*废弃版本*

### 1.0.44

- 修复在修改「授权链接」、「批处理」时，意外再次传递ID导致请求失败的问题

### 1.0.42 ~ 1.0.43

- 增加内置脚本集的提示标签

### 1.0.41

- 通过环境变量进行配置时，需要添加`DFF_`前缀。（如：环境变量`DFF_MYSQL_HOST`对应配置为`MYSQL_HOST`）

### 1.0.39 ~ 1.0.40

- 修复文案问题

### 1.0.37 ~ 1.0.38

- 缩减0（系统）、7（调试）队列并发量，减少基础资源消耗

### 1.0.35 ~ 1.0.36

- 为携带版提供gzip压缩

### 1.0.32 ~ 1.0.34

- 配置项`MODE`值为`prod`（默认）时，不再输出MySQL和Redis的具体操作SQL/命令
- 函数超时错误不再输出日志
- 脚本日志/脚本故障模块默认关闭
- 缩减错误堆栈信息数据，默认不输出每一帧的本地变量信息
- 自动部署脚本自动创建logrotate配置，并支持更换安装路径

### 1.0.31

- 修复`DFF.FUNC(...)`未能正确传递变量的BUG

### 1.0.30

- DEBUG任务现在默认发送到7号队列
- Docker Stack 文件中Worker拆分为4个：

| 队列编号 |   用途  |
|----------|---------|
| `0`      | 系统    |
| `1 ~ 6`  | 通用    |
| `7`      | 调试    |
| `8 ~ 9`  | CPU密集 |

### 1.0.29

- `@DFF.API`装饰器添加`hint`选项，可填写任意可序列化为JSON的内容，并在函数列表的`extraConfigJSON`字段中出现。

### 1.0.28

- 修复自动备份功能意外将迁移数据一同备份的问题

### 1.0.25 ~ 1.0.27

- 增加数据库自动备份功能
- 修复已知问题

### 1.0.24

- 「授权链接」在添加时支持指定自定义ID（但必须以`auln-`开头）
- 「批处理」在添加时支持指定自定义ID（但必须以`bat-`开头）

### 1.0.23

- 修复已知问题

### 1.0.21 ~ 1.0.22

- 「成员管理」、「AccessKey 管理」移动到管理版块

### 1.0.20

- 不再使用`DataFlux.f(x)`命名，统一使用`DataFlux Func`

### 1.0.19

- 废除`EXTRA_PYTHON_IMPORT_PATH_LIST`配置，改为`EXTRA_PYTHON_IMPORT_PATH`（仅支持一个地址）。
- 修复已知故障

### 1.0.18

- 添加队列压力计算模块，保护队列（仅针对同步调用）
    - 压力 <= 100 时：正常处理
    - 100 < 压力 < 200 时：按照 {压力 - 100}% 概率随机丢弃同步调用请求
- 「管理-总览」页面添加队列压力展示
- ID字段改为`utf8mb4`编码
- 已添加的数据源可以测试连通性（添加「测试」按钮）
- 脚本上下文添加`_DFF_HTTP_REQUEST`，用于保存HTTP请求详情
- UI调整/优化
- 修复已知问题

*注意：本次更新虽然修改了数据库修改编码，但不提供自动迁移功能。如保持ID字段为`ascii`编码不会影响系统运行，但列表页面的搜索功能将无法使用*

### 1.0.15 ~ 1.0.17

- 调整CD/CI配置

### 1.0.15

- 调整任务队列命名及逻辑：
    - 去除`default`队列
    - `0`作为整个系统兜底默认队列，主要执行系统级任务
    - `1`作为函数执行的默认队列，函数默认在此队列中执行
    - 添加`WORKER_QUEUE_ALIAS_MAP`参数，支持队列别名，如：`cpu=9`表示，指定`queue='cpu'`时，函数运行在`9`队列
- 配置载入时，允许以`CUSTOM_`开头添加自定义配置。且脚本内可以访问`CUSTOM_`开头的配置
- 增强`DFF`对象：
    - 添加`DFF.STORE(key, scope=None)`访问方式
    - 添加`DFF.CACHE(key, scope=None)`访问方式
    - 增强`DFF.SRC`，添加以下功能
        - `DFF.SRC.list()`列出数据源
        - `DFF.SRC.save(...)`保存数据源
        - `DFF.SRC.delete(...)`删除数据源
    - 增强`DFF.ENV`，添加以下功能
        - `DFF.ENV.list()`列出环境变量
        - `DFF.ENV.save(...)`保存环境变量
        - `DFF.ENV.delete(...)`删除环境变量
    - 添加`DFF.CONFIG`用于访问自定义配置（`CUSTOM_`开头的配置项），包含
        - `DFF.CONFIG(...)` / `DFF.get(...)`获取配置
        - `DFF.list()`列出配置
    - 添加`DFF.API(integration='autoRun', integration_config={...})`配置，允许函数自动运行
        - `integration_config={ 'crontab': '* * * * *' }`函数定期自动执行
        - `integration_config={ 'onPublish': True }`函数发布后自动执行
        - `integration_config={ 'onLaunch': True }`系统启动时，函数自动执行
- 授权链接列表页面增加统计信息视图，包含
    - 近日调用次数
    - 近期响应速度（min, max, avg, mid）
    - 近期响应速度分布（p75, p95, p99)
- 添加`NSQ`数据源
- 调整编辑器左侧树状列表样式
- 脚本预览页面添加下载按钮（支持下载草稿、已发布、和DIFF）
- 在函数使用了命名参数`**kwargs`时，API示例、授权链接/批处理配置页面会展示相应允许自定义参数的提示
- 升级WAT SDK，支持配置HTTP 认证头
- 修复已知问题，优化代码

### 1.0.11 ~ 1.0.14

- 修复已知问题

### 1.0.10

- 调整任务队列命名及逻辑：
    - `default`作为整个系统兜底默认队列，主要执行系统级任务
    - `0`作为函数执行的默认队列，函数默认在此队列中执行
    - `1`～`9`作为扩展队列，允许函数指定在这些队列中执行
    - 编辑器中调试执行函数，固定在`0`队列执行
- `@DFF.API`装饰器添加`queue`参数，允许指定函数被执行时，指定队列
- `@DFF.API`装饰器添加`api_timeout`参数，允许指定函数作为API调用时的HTTP超时时间
- 各项默认超时时间调整：
    - 编辑器调试运行函数时，固定超时时间为60秒
    - 函数默认执行超时时间为30秒（可通过`@DFF.API`装饰器`timeout`参数指定1～3600秒之间的值）
    - 函数默认API超时时间为10秒（可通过`@DFF.API`装饰器`api_timeout`参数指定1～180秒之间的值）

### 1.0.8 ~ 1.0.9

- 调整函数执行超时、API接口调用超时、工作单元数量等配置
- 函数允许使用`**kwargs`命名参数，系统不再拒绝向函数传递不在参数列表中的函数。

### 1.0.7

- 修复无法导入额外Python 包的问题

### 1.0.6

- 代码编辑器添加搜索功能
- 代码编辑器增加Python关键字、DataFlux Func 内置功能语句等自动补全
- 添加《包学包会》文档链接
- 添加`EXTRA_PYTHON_IMPORT_PATH_LIST`配置，支持额外Python import 路径列表。
- 修复已知故障

### 1.0.5

- 添加用于重置管理员账号的环境变量（`RESET_ADMIN_USERNAME`、`RESET_ADMIN_PASSWORD`）

### 1.0.3 ~ 1.0.4

- 更新README文案

### 1.0.2

- 更新自动化部署脚本

### 1.0.1

- 更新GitLab CI 文件
- 更新数据库初始化文件

### 1.0.0

- 初版发布
